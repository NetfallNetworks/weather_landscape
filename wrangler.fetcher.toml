# Weather Fetcher Worker Configuration
# Deploy with: wrangler deploy -c wrangler.fetcher.toml

name = "weather-fetcher"
main = "src/workers/weather_fetcher.py"
compatibility_date = "2025-01-10"
compatibility_flags = ["python_workers"]

# Enable workers.dev for testing (can be disabled in production)
workers_dev = true

# Workers Logs - enables log collection for visibility during runs
[observability]
enabled = true

# Bundle image files as Data modules (needed for shared imports)
[[rules]]
type = "Data"
globs = ["**/*.bmp", "**/*.png", "**/*.jpg", "**/*.jpeg"]
fallthrough = true

# Bundle HTML templates as Text modules
[[rules]]
type = "Text"
globs = ["src/templates/*.html"]
fallthrough = true

# Bundle CSS files as Text modules
[[rules]]
type = "Text"
globs = ["**/*.css"]
fallthrough = true

# Cron Trigger - runs every 15 minutes to fetch weather and enqueue jobs
[triggers]
crons = ["*/15 * * * *"]

# KV Namespace Binding - stores configuration and metadata
# Use the same namespace ID as the web worker
[[kv_namespaces]]
binding = "CONFIG"
id = "YOUR_KV_NAMESPACE_ID"

# Queue Producer Binding - sends jobs to landscape generator
[[queues.producers]]
queue = "landscape-jobs"
binding = "LANDSCAPE_JOBS"

# Environment Variables
[vars]
DEFAULT_ZIP = "78729"

# Note: Set OWM_API_KEY using:
# wrangler secret put OWM_API_KEY -c wrangler.fetcher.toml
